<% content_for :head do %>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<% end %>

<%= nested_form_for(@annonce, html: { class: "form-horizontal", role: "form" }) do |f| %>
<% if @annonce.errors.any? %>
<div class="alert alert-danger alert-dismissable" role="alert">
  <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
  <h4><%= pluralize(@annonce.errors.count, "error") %> prohibited this annonce from being saved:</h4>

  <ul>
    <% @annonce.errors.full_messages.each do |msg| %>
    <li><%= msg %></li>
    <% end %>
  </ul>
</div>
<% end %>


<div class="form-group">

  <%= f.label :name, class: "col-sm-2 control-label" %>
  <div class="col-sm-10">
    <%= f.text_field :name, class: "form-control" %>
  </div>

</div>

<div class="form-group">

  <%= f.label :avatar, class: "col-sm-2 control-label" %>
  <div class="col-sm-10">
    <% if annonce.avatar.url.present? %>
    <%= image_tag(annonce.avatar.url.to_s) %>
    <%= f.label :remove_avatar do %>
    <%= f.check_box :remove_avatar %>
    <% end %>
    <% end %>
    <%= f.file_field :avatar %>
    <%= f.hidden_field :avatar_cache %>
  </div>

</div>

<div class="form-group">

  <%= f.label :experience, class: "col-sm-2 control-label" %>
  <div class="col-sm-10">
    <%= f.date_select :experience, class: "form-control" %>
  </div>

</div>

<div class="form-group">

  <%= f.label :description, class: "col-sm-2 control-label" %>
  <div class="col-sm-10">
    <%= f.text_area :description, class: "form-control" %>
  </div>

</div>


<%= f.hidden_field :type, class: "form-control" %>


<div class="form-group">

  <%= f.label :style, class: "col-sm-2 control-label" %>
  <div class="col-sm-10">
    <%= f.text_field :style, class: "form-control" %>
  </div>

</div>

<div class="form-group">

  <%= f.label :level, class: "col-sm-2 control-label" %>
  <div class="col-sm-10">
    <%= f.select :level,options_for_select(Annonce.levels.keys.to_a),{class: 'form-control'} if @type == 'Group'%>
  </div>

</div>

<div class="form-group">

  <%= f.label :min_days_for_booking, class: "col-sm-2 control-label" %>
  <div class="col-sm-10">
    <%= f.number_field :min_days_for_booking, class: "form-control" %>
  </div>

</div>

<div class="form-group">

  <%= f.label :price, class: "col-sm-2 control-label" %>
  <div class="col-sm-10">
    <%= f.number_field :price, class: "form-control" %>
  </div>

</div>

<div class="form-group">

  <%= f.label :avg_time, class: "col-sm-2 control-label" %>
  <div class="col-sm-10">
    <%= f.number_field :avg_time, class: "form-control" %>
  </div>

</div>
<div class="form-group">
  <b class="col-sm-2 control-label">Liens : </b>
  <div class="col-sm-8">
   <ul id="links">
    <%= f.fields_for :links do |links_form| %>
    <div class="row">    
      <li class="">
        <div class="row form-group">
         <div class="col-md-3">

           <%= links_form.select :site, Link.sites.map {|r| [r.humanize, r.camelcase]}, {},class: "form-control"%> 
         </div>
         <div class="col-md-5">

           <%= links_form.text_field :url , class: "form-control"%>
         </div>
         <div class="col-md-2">
          <%= links_form.link_to_remove  :class =>"btn btn-danger" do  %>
          <span class="glyphicon glyphicon-remove"></span>
          <% end %>
        </div>
      </div>
    </li>
  </div>
  <% end %>
</ul>
<p><%= f.link_to_add I18n.t('button.add'), :links, :data => { :target => "#links" } , class: "col-sm-2 btn btn-success"%></p>

</div>
</div>

<div class="form-group">

  <div class="col-sm-10 col-sm-offset-2">
   <div class="" id="dispo1">

   </div>
   <div class="" id="dispo2">

   </div>
   <div class="" id="dispo3">

   </div>
 </div>

</div>


<div class="form-group">
  <div class="col-sm-offset-2 col-sm-10">
    <%= f.submit class: "btn btn-primary" %>
  </div>
</div>
<% end %>





<script type="text/javascript">

  var today = new Date();
  var month = today.getMonth();
  console.log(month);
  $('#dispo1').datepicker({
    format: 'dd/mm/yyyy',
    language: 'fr',
    multidate:true,
    startDate: today,
    endDate: new Date(today.getFullYear(),month+1,0),
  });
  $('#dispo2').datepicker({
    format: 'dd/mm/yyyy',
    language: 'fr',
    multidate:true,
    startDate: new Date(today.getFullYear(),month+1,1),
    endDate:new Date(today.getFullYear(),month+2,0),
  });
  $('#dispo3').datepicker({
    format: 'dd/mm/yyyy',
    language: 'fr',
    multidate:true,
    startDate: new Date(today.getFullYear(),month+2,1),
    endDate: new Date(today.getFullYear(),month+3,0)
  });
</script>





<%= form_for Preview.new , multiple: true do |f| %>
<div class="row">
  <%= f.hidden_field :annonce_token, value: @annonce.token %>

  <div class=" fileupload-buttonbar">
    <div class="progressbar fileupload-progressbar nofade"><div style="width:0%;"></div></div>
    <span class="btn btn-mini fileinput-button">
      <i class="icon-plus"></i>
      <span><%= "ajouter" %>...</span>
      <%= f.file_field :file, :multiple => true %>
    </span>
  </div>
</div>

<h2>Pictures</h2>
<br>
<div class="row">
  <ul class="thumbnails files">
  </ul>
</div>
<div class="form-group">
  <div class="col-sm-offset-2 col-sm-10">
    <%= f.submit class: "btn btn-primary" %>
  </div>
</div>
<% end %>